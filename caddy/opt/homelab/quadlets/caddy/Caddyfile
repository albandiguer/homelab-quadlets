# Caddy reverse proxy configuration
# All services accessible via *.lab and *.lab.albandiguer.dev domains through VPN

# Global options to disable automatic HTTPS
{
    auto_https off
    admin off
}

# Health check endpoint
http://:80/health {
    respond "OK" 200
}

# Active services
http://pihole.lab, http://pihole.lab.albandiguer.dev {
    redir / /admin
    reverse_proxy localhost:8053
}

http://linkding.lab, http://linkding.lab.albandiguer.dev {
    reverse_proxy localhost:9090
}

http://n8n.lab, http://n8n.lab.albandiguer.dev, http://n8n.albandiguer.dev {
    reverse_proxy localhost:5678
}

http://mcp-hub.lab, http://mcp-hub.lab.albandiguer.dev {
    reverse_proxy localhost:3000
}

http://readeck.lab, http://readeck.lab.albandiguer.dev {
    reverse_proxy localhost:8000
}

http://mealie.lab, http://mealie.lab.albandiguer.dev {
    reverse_proxy localhost:9000
}

# Uptime kuma
# http://uptime.lab, http://uptime.lab.albandiguer.dev {
#     reverse_proxy localhost:3001 
# }
#
# http://home.lab, http://homepage.lab, http://homepage.lab.albandiguer.dev {
#     reverse_proxy 127.0.0.1:3030
# }

# Plane project management
http://plane.lab, http://plane.lab.albandiguer.dev {
    reverse_proxy localhost:8085
    # Route different paths to different services
    handle_path /spaces/* {
        reverse_proxy localhost:3001
    }

    handle_path /god-mode/* {
        reverse_proxy localhost:3002
    }

    handle_path /live/* {
        reverse_proxy localhost:3003
    }

    handle_path /api/* {
        reverse_proxy localhost:8000
    }

    handle_path /auth/* {
        reverse_proxy localhost:8000
    }

    handle_path /plane/* {
        reverse_proxy localhost:9000
    }
}
