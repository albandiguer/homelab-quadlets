[Unit]
Description=Plane MinIO Object Storage
After=network-online.target
Requires=plane.pod
After=plane-pod.service
BindsTo=plane-pod.service

[Container]
Image=docker.io/minio/minio:latest
ContainerName=plane-minio
Pod=plane.pod

# Secret keys

# MinIO credentials
Environment=MINIO_ROOT_USER=${PLANE_MINIO_ROOT_USER}
# Environment=MINIO_ROOT_PASSWORD=${PLANE_MINIO_ROOT_PASSWORD}
# NOTE: using secret instead
Secret=plane_minio_root_password,target=MINIO_ROOT_PASSWORD,type=env

# Persist MinIO data on configured storage volume
Volume=${QUADLET_STORAGE_PATH}/plane/minio:/data

# MinIO server command
Exec=server /data --console-address ":9001"

# Health check
HealthCmd=/usr/bin/curl -f http://localhost:9000/minio/health/live || exit 1
HealthInterval=30s
HealthTimeout=10s
HealthRetries=3

[Service]
Restart=always
RestartSec=30

[Install]
WantedBy=multi-user.target default.target
